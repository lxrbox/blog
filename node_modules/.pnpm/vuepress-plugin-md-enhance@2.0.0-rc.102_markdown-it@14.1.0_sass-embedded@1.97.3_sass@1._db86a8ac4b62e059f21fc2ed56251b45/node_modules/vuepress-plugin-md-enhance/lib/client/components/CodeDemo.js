import{isDef as N,isPlainObject as M,keys as _,decodeData as $,LoadingIcon as k}from"@vuepress/helper/client";import{useToggle as P,useEventListener as x,useResizeObserver as T}from"@vueuse/core";import{defineComponent as B,shallowRef as C,ref as E,computed as g,h as o,onMounted as V}from"vue";import{J as H,C as I}from"../icons-DBCMtobF.js";import"balloon-css/balloon.css";import"../styles/code-demo.scss";const S=CODE_DEMO_OPTIONS,O={html:{types:["html","slim","haml","md","markdown","vue"],map:{html:"none",vue:"none",md:"markdown"}},js:{types:["js","javascript","coffee","coffeescript","ts","typescript","ls","livescript"],map:{js:"none",javascript:"none",coffee:"coffeescript",ls:"livescript",ts:"typescript"}},css:{types:["css","less","sass","scss","stylus","styl"],map:{css:"none",styl:"stylus"}}},J=(e,s,t)=>{const a=document.createElement(e);return M(s)&&_(s).forEach(n=>{if(n.indexOf("data"))a[n]=s[n];else{const r=n.replace("data","");a.dataset[r]=s[n]}}),a},L=e=>({...S,...e,jsLib:[...new Set([S.jsLib,e.jsLib??[]].flat())],cssLib:[...new Set([S.cssLib,e.cssLib??[]].flat())]}),u=(e,s)=>{if(N(e[s]))return e[s];const t=new Promise(a=>{const n=document.createElement("script");n.src=s,document.querySelector("body")?.append(n),n.addEventListener("load",()=>{a()})});return e[s]=t,t},q=(e,s)=>{if(s.css&&[...e.childNodes].every(t=>t.nodeName!=="STYLE")){const t=J("style",{innerHTML:s.css});e.append(t)}},F=(e,s,t)=>{const a=t.getScript();if(a&&[...s.childNodes].every(n=>n.nodeName!=="SCRIPT")){const n=document.createElement("script");n.append(document.createTextNode(`{const document=window.document.querySelector('#${e} .vp-code-demo-display').shadowRoot;
${a}}`)),s.append(n)}},G=["html","js","css"],z=e=>{const s=_(e),t={html:[],js:[],css:[],isLegal:!1};return G.forEach(a=>{const n=s.filter(r=>O[a].types.includes(r));if(n.length>0){const[r]=n;t[a]=[e[r].replaceAll(/^\n|\n$/g,""),O[a].map[r]??r]}}),t.isLegal=(t.html.length===0||t.html[1]==="none")&&(t.js.length===0||t.js[1]==="none")&&(t.css.length===0||t.css[1]==="none"),t},A=e=>e.replaceAll(String.raw`<br \/>`,"<br>").replaceAll(/<((\S+)[^<]*?)\s+\/>/g,"<$1></$2>"),D=e=>`<div id="app">
${A(e)}
</div>`,U=e=>`${e.replace("export default ","const $reactApp = ").replace(/App\.__style__(\s*)=(\s*)`([\s\S]*)?`/,"")};
ReactDOM.createRoot(document.getElementById("app")).render(React.createElement($reactApp))`,Y=e=>e.replace(/export\s+default\s*\{(\n*[\s\S]*)\n*\}\s*;?$/u,"Vue.createApp({$1}).mount('#app')").replace(/export\s+default\s*define(Async)?Component\s*\(\s*\{(\n*[\s\S]*)\n*\}\s*\)\s*;?$/u,"Vue.createApp({$1}).mount('#app')").trim(),R=e=>`(function(exports){var module={};module.exports=exports;${e};return module.exports.__esModule?exports.default:module.exports;})({})`,K=(e,s)=>{const t=L(s),a=e.js[0]??"";return{...t,html:A(e.html[0]??""),js:a,css:e.css[0]??"",isLegal:e.isLegal,getScript:()=>t.useBabel?window.Babel?.transform(a,{presets:["es2015"]})?.code??"":a}},Q=/<template>([\s\S]+)<\/template>/u,W=/<script(\s*lang=(['"])(.*?)\2)?>([\s\S]+)<\/script>/u,X=/<style(\s*lang=(['"])(.*?)\2)?\s*(?:scoped)?>([\s\S]+)<\/style>/u,Z=(e,s)=>{const t=L(s),a=e.html[0]??"",n=Q.exec(a),r=W.exec(a),c=X.exec(a),d=n?.[1].replaceAll(/^\n|\n$/g,"")??"",i=r?.[4].replaceAll(/^\n|\n$/g,"")??"",p=r?.[3]??"",l=c?.[4].replaceAll(/^\n|\n$/g,"")??"",v=c?.[3]??"",f=p===""&&(v===""||v==="css");return{...t,html:D(d),js:Y(i),css:l,isLegal:f,jsLib:[t.vue,...t.jsLib],getScript:()=>{const h=s.useBabel?window.Babel?.transform(i,{presets:["es2015"]})?.code??"":i.replace(/export\s+default/u,"return");return`const app=window.document.createElement('div');document.firstElementChild.appendChild(app);const appOptions=${R(h)};appOptions.template=\`${d.replace("`",'\\`"')}\`;window.Vue.createApp(appOptions).mount(app);`}}},ee=(e,s)=>{const t=L(s),a=e.js[0]??"";return{...t,html:D(""),js:U(a),css:e.css[0]??e.js[0]?.replace(/App\.__style__(?:\s*)=(?:\s*)`([\s\S]*)?`/,"$1").trim()??"",isLegal:e.isLegal,jsLib:[t.react,t.reactDOM,...t.jsLib],jsx:!0,getScript:()=>{const n=window.Babel?.transform(a,{presets:["es2015","react"]})?.code??"";return`window.ReactDOM.createRoot(document.firstElementChild).render(window.React.createElement(${R(n)}))`}}},m={},te=async e=>{await Promise.all([u(m,e.babel),u(m,e.react),u(m,e.reactDOM)])},se=async e=>{const s=[u(m,e.vue)];e.useBabel&&s.push(u(m,e.babel)),await Promise.all(s)},ae=e=>e.useBabel?u(m,e.babel):Promise.resolve();var le=B({name:"CodeDemo",props:{id:{type:String,required:!0},type:{type:String,default:"normal"},title:String,config:String,code:{type:String,required:!0}},slots:Object,setup(e,{slots:s}){const[t,a]=P(!1),n=C(),r=C(),c=E("0"),d=E(!1),i=g(()=>JSON.parse(e.config?$(e.config):"{}")),p=g(()=>{const y=JSON.parse($(e.code));return z(y)}),l=g(()=>e.type==="react"?ee(p.value,i.value):e.type==="vue"?Z(p.value,i.value):K(p.value,i.value)),v=g(()=>l.value.isLegal),f=(y=!1)=>{const j=n.value.attachShadow({mode:"open"}),w=document.createElement("div");w.classList.add("code-demo-app"),j.append(w),v.value?(y&&(w.innerHTML=l.value.html),q(j,l.value),F(e.id,j,l.value),c.value="0"):c.value="auto",d.value=!0},h=async()=>{switch(e.type){case"react":{await te(l.value),f();break}case"vue":{await se(l.value),f();break}default:await ae(l.value),f(!0)}};let b=null;return x("beforeprint",()=>{a(!0)}),x("afterprint",()=>{b!==null&&a(b),b=null}),T(r,()=>{t.value&&(c.value=`${r.value.clientHeight+14}px`)}),V(async()=>{await h()}),()=>o("div",{class:"vp-container vp-code-demo",id:e.id},[o("div",{class:"vp-container-header"},[l.value.isLegal?o("button",{type:"button",title:"toggle",class:["vp-code-demo-toggle-button",t.value?"down":"end"],onClick:()=>{c.value=t.value?"0":`${r.value.clientHeight+14}px`,a()}}):null,e.title?o("span",{class:"vp-container-title"},decodeURIComponent(e.title)):null,l.value.isLegal&&(l.value.jsfiddle??!0)?o("form",{class:"code-demo-jsfiddle",target:"_blank",action:"https://jsfiddle.net/api/post/library/pure/",method:"post"},[o("input",{type:"hidden",name:"html",value:l.value.html}),o("input",{type:"hidden",name:"js",value:l.value.js}),o("input",{type:"hidden",name:"css",value:l.value.css}),o("input",{type:"hidden",name:"wrap",value:"1"}),o("input",{type:"hidden",name:"panel_js",value:"3"}),o("input",{type:"hidden",name:"resources",value:[...l.value.cssLib,...l.value.jsLib].join(",")}),o("button",{type:"submit",class:"jsfiddle-button",innerHTML:H,"aria-label":"JSFiddle","data-balloon-pos":"down"})]):null,!l.value.isLegal||(l.value.codepen??!0)?o("form",{class:"code-demo-codepen",target:"_blank",action:"https://codepen.io/pen/define",method:"post"},[o("input",{type:"hidden",name:"data",value:JSON.stringify({html:l.value.html,js:l.value.js,css:l.value.css,js_external:l.value.jsLib.join(";"),css_external:l.value.cssLib.join(";"),layout:l.value.codepenLayout,html_pre_processor:p.value.html[1]??"none",js_pre_processor:p.value.js[1]??(l.value.jsx?"babel":"none"),css_pre_processor:p.value.css[1]??"none",editors:l.value.codepenEditors})}),o("button",{type:"submit",innerHTML:I,class:"codepen-button","aria-label":"Codepen","data-balloon-pos":"down"})]):null]),d.value?null:o(k,{class:"vp-code-demo-loading"}),o("div",{ref:n,class:"vp-code-demo-display",style:{display:v.value&&d.value?"block":"none"}}),o("div",{class:"vp-code-demo-code-wrapper",style:{height:c.value}},o("div",{ref:r,class:"vp-code-demo-codes"},s.default()))])}});export{le as default};
//# sourceMappingURL=CodeDemo.js.map
