import{LoadingIcon as w,keys as T}from"@vuepress/helper/client";import{defineComponent as A,ref as b,h as _,onMounted as v,onUnmounted as R,camelize as h}from"vue";import{useLang as D}from"vuepress/client";import{g as I}from"../getLink-DBmDl_2w.js";import"../styles/art-player.scss";import{u as M}from"../useSize-DACCJVjo.js";import"@vueuse/core";const f=["mp4","mp3","webm","ogg"],g=typeof DASHJS_INSTALLED=="boolean"&&DASHJS_INSTALLED,E=typeof HLS_JS_INSTALLED=="boolean"&&HLS_JS_INSTALLED,L=typeof MPEGTS_JS_INSTALLED=="boolean"&&MPEGTS_JS_INSTALLED;g&&f.push("mpd","dash"),E&&f.push("m3u8","hls"),L&&f.push("ts","flv");const k=e=>e.split(".").pop()??"",z=async(e,a,r,{autoPlay:s=!1,startTime:o=0}={})=>{if(!__VUEPRESS_SSR__&&g){const{default:y}=await import("dashjs");if(y.supportsMediaSource()){const S=y.MediaPlayer().create();S.initialize(e,a,s,o),r(()=>{S.destroy()})}}},N=async(e,a,r)=>{if(!__VUEPRESS_SSR__&&L){const{default:s}=await import("mpegts.js/dist/mpegts.js");if(s.isSupported()){const o=s.createPlayer({type:"flv",url:a});o.attachMediaElement(e),o.load(),r(()=>{o.destroy()})}}},U=async(e,a,r)=>{if(!__VUEPRESS_SSR__){if(e.canPlayType("application/x-mpegURL")||e.canPlayType("application/vnd.apple.mpegURL"))e.src=a;else if(E){const{default:s}=await import("hls.js/dist/hls.min.js");if(s.isSupported()){const o=new s;o.attachMedia(e),o.on(s.Events.MEDIA_ATTACHED,()=>{o.loadSource(a)}),r(()=>{o.destroy()})}}}},H=["no-fullscreen","no-hotkey","no-playback-rate","no-setting","no-mutex","no-plays-inline"],J=["airplay","autoplay","aspect-ratio","auto-mini","auto-size","auto-orientation","auto-playback","fast-forward","flip","fullscreen-web","lock","loop","is-live","muted","mini-progress-bar","pip","screenshot","subtitle-offset"],C=new Set(["en","pl","cs","es","fa","fr","id","ru","tr"]),O=new Set(["zh-cn","zh-tw"]),V=e=>{const a=e.toLowerCase(),[r]=a.split("-");return O.has(a)?a:C.has(r)?r:r==="zh"?"zh-cn":"en"};var x=A({name:"ArtPlayer",inheritAttrs:!1,props:{src:{type:String,required:!0},type:String,poster:String,title:String,width:{type:[String,Number],default:"100%"},height:[String,Number],ratio:{type:[String,Number],default:16/9},config:Object,customPlayer:Function},setup(e,{attrs:a}){const r=D(),{el:s,width:o,height:y,resize:S}=M(e,0),d=b(!1);let m=null;const P=()=>{const t={theme:"#3eaf7c",...ART_PLAYER_OPTIONS,container:s.value,poster:e.poster??"",url:I(e.src),type:e.type??k(e.src),lang:V(r.value),...e.config,useSSR:!1},i=T(a);if(H.forEach(n=>{i.includes(n)&&(t[h(n.replace(/^no-/,""))]=!1)}),J.forEach(n=>{i.includes(n)&&(t[h(n)]=!0)}),t.type){const n=t.customType??={};if(f.includes(t.type.toLowerCase()))switch(t.type.toLowerCase()){case"m3u8":case"hls":{n[t.type]??=(l,p,c)=>U(l,p,u=>{c.on("destroy",u)});break}case"flv":case"ts":{n[t.type]??=(l,p,c)=>N(l,p,u=>{c.on("destroy",u)});break}case"mpd":case"dash":{n[t.type]??=(l,p,c)=>z(l,p,u=>{c.on("destroy",u)});break}}else console.warn(`[components]: ArtPlayer does not support current file type ${t.type}!`)}return t};return v(async()=>{if(__VUEPRESS_SSR__)return;const{default:t}=await import("artplayer"),i=new t(P());m=await e.customPlayer?.(i)??i,d.value=!0,S()}),R(()=>{m?.destroy()}),()=>[_("div",{ref:s,class:"vp-artplayer",style:{width:o.value,height:y.value}}),d.value?null:_(w)]}});export{x as default};
//# sourceMappingURL=ArtPlayer.js.map
