---
title: MySQL 索引详解
date: 2026-02-09
icon: book
category:
  - 技术笔记
tag:
  - 项目笔记
---

## 什么是主键索引？
1. 主键索引是每张表都有的一个索引，建表的时候就已经存在
2. 主键索引上存储了整行的数据
3. 叶子节点中的数据还是需要顺序查找，
如┌─────────────────────────────────────────────────────────────────────────┐
│                           B+ 树聚集索引结构                              │
│                         (假设每个节点存 2 个键)                          │
└─────────────────────────────────────────────────────────────────────────┘

                                    [1005]
                                   /      \
                                  /        \
                    ┌────────────┘          └────────────┐
                    │                                    │
                 [1002]                              [1008]
                /       \                            /      \
               /         \                          /        \
    ┌─────────┘           └─────────┐    ┌─────────┘          └─────────┐
    │                               │    │                              │
   叶子节点                         叶子节点                            叶子节点
┌─────────────────┐           ┌─────────────────┐                ┌─────────────────┐
│ Key   |  Data   │           │ Key   |  Data   │                │ Key   |  Data   │
├─────────────────┤           ├─────────────────┤                ├─────────────────┤
│ 1001  │ 完整行1 │◄──┐       │ 1005  │ 完整行3 │                │ 1008  │ 完整行4 │
│ 1002  │ 完整行2 │   │       ├─────────────────┤                └─────────────────┘
└─────────────────┘   │       │ ...   │  ...    │                      ▲
       ▲              │       └─────────────────┘                      │
       │              │              ▲                                 │
       │              └──────────────┘                                 │
       │              (双向链表连接，支持范围扫描)                        │
       │                                                               │
       └───────────────────────────────────────────────────────────────┘
       
    叶子节点之间用双向链表连接，保证范围查询效率（如 WHERE product_id > 1002）


## 商品表的联合索引存储情况

### 看联合索引 idx_state_time(state, create_time)

#### 结构本质是：

`B+ 树按： (state, create_time, 主键) 排序`

逻辑顺序类似：

`(1, 2024-01-01, id=10) (1, 2024-01-03, id=11) (2, 2024-01-01, id=20) (2, 2024-01-02, id=21)`

B+树结构图：

        | (1, 2024-01-03, 11) |
       /                     \
   左子树                 右子树


索引结构

```
a   b   c
------------
1   1   1
1   1   2
1   2   1
1   2   2
2   1   1
2   1   2
2   2   1
2   2   2
3   1   1
3   2   1

```

**也就是说，当左侧使用 >1  的时候，右侧是不是按顺序排序。**
**只有当左侧索引的相等的时候，右侧的索引才是按顺序排列的！**

---

### 4️⃣ 前缀原则为什么成立？（核心原因）

因为：

> **B+ 树只能从“排序的起点”连续扫描**

所以：

|查询条件|能否用索引|原因|
|---|---|---|
|`state = 1`|✅|命中第 1 列|
|`state = 1 AND create_time > '2024-01-01'`|✅|连续使用|
|`create_time > '2024-01-01'`|❌|跳过 state|
|`state > 1 AND create_time > ...`|❌（create_time 用不上）|state 已是范围|

👉 **一旦某一列变成范围，后面的列全部失效**
